"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Radar = void 0;
class Radar {
    constructor(canvas, maximumDistance = 200, numberOfRings = 8) {
        this.canvas = canvas;
        this.maximumDistance = maximumDistance;
        this.numberOfRings = numberOfRings;
        this.centerX = 0;
        this.centerY = 0;
        this.outerRadius = 0;
        this.context = canvas.getContext('2d');
    }
    refresh() {
        this.update();
        this.renderBackground();
        this.renderLines();
        this.renderRings();
    }
    renderAll(localPlayer, players, mode) {
        for (const x of players) {
            if (x.isLocal)
                continue;
            this.renderOne(localPlayer, x.localOrigin.value, x.createColor(localPlayer, mode));
        }
    }
    renderOne(localPlayer, localOrigin, style) {
        const dx = (localPlayer.localOrigin.value.x - localOrigin.x) * 0.0254;
        const dy = (localPlayer.localOrigin.value.y - localOrigin.y) * 0.0254;
        const r = Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));
        if (r < this.maximumDistance) {
            const s = this.outerRadius / this.maximumDistance;
            const a = Math.sign(dy) * Math.acos(dx / r) - localPlayer.viewAngles.value.y * Math.PI / 180;
            const x = this.centerX + Math.sin(a) * r * s;
            const y = this.centerY + Math.cos(a) * r * s;
            this.context.beginPath();
            this.context.arc(x, y, this.outerRadius / 40, 0, Math.PI * 2);
            this.context.fillStyle = style;
            this.context.fill();
        }
    }
    renderBackground() {
        this.context.beginPath();
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.context.arc(this.centerX, this.centerY, this.outerRadius, 0, Math.PI * 2);
        this.context.fillStyle = '#000';
        this.context.fill();
    }
    renderLines() {
        this.context.strokeStyle = '#FFF';
        for (let i = 0; i < 8; i++) {
            const x = this.centerX + this.outerRadius * Math.cos(i * Math.PI * 0.25);
            const y = this.centerY + this.outerRadius * Math.sin(i * Math.PI * 0.25);
            this.context.beginPath();
            this.context.moveTo(this.centerX, this.centerY);
            this.context.lineTo(x, y);
            this.context.stroke();
        }
    }
    renderRings() {
        this.context.strokeStyle = '#FFF';
        for (let i = 1; i <= this.numberOfRings; i++) {
            this.context.beginPath();
            this.context.arc(this.centerX, this.centerY, this.outerRadius * i / this.numberOfRings, 0, Math.PI * 2);
            this.context.stroke();
        }
    }
    update() {
        this.centerX = this.canvas.width / 2;
        this.centerY = this.canvas.height / 2;
        this.outerRadius = (this.canvas.width > this.canvas.height ? this.canvas.height : this.canvas.width) / 2;
    }
}
exports.Radar = Radar;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmFkYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL2ZlYXR1cmVzL1JhZGFyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUVBLE1BQWEsS0FBSztJQU1oQixZQUNtQixNQUF5QixFQUN6QixrQkFBa0IsR0FBRyxFQUNyQixnQkFBZ0IsQ0FBQztRQUZqQixXQUFNLEdBQU4sTUFBTSxDQUFtQjtRQUN6QixvQkFBZSxHQUFmLGVBQWUsQ0FBTTtRQUNyQixrQkFBYSxHQUFiLGFBQWEsQ0FBSTtRQVA1QixZQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ1osWUFBTyxHQUFHLENBQUMsQ0FBQztRQUNaLGdCQUFXLEdBQUcsQ0FBQyxDQUFDO1FBTXRCLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUUsQ0FBQztJQUMxQyxDQUFDO0lBRUQsT0FBTztRQUNMLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNkLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUVELFNBQVMsQ0FBQyxXQUF1QixFQUFFLE9BQTBCLEVBQUUsSUFBYTtRQUMxRSxLQUFLLE1BQU0sQ0FBQyxJQUFJLE9BQU8sRUFBRTtZQUN2QixJQUFJLENBQUMsQ0FBQyxPQUFPO2dCQUFFLFNBQVM7WUFDeEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztTQUNwRjtJQUNILENBQUM7SUFFRCxTQUFTLENBQUMsV0FBdUIsRUFBRSxXQUF1QixFQUFFLEtBQThDO1FBQ3hHLE1BQU0sRUFBRSxHQUFHLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUM7UUFDdEUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQztRQUN0RSxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkQsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUM1QixNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUM7WUFDbEQsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUM7WUFDN0YsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJ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QUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDM0csQ0FBQztDQUNGO0FBN0VELHNCQTZFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFwcCBmcm9tICcuLic7XG5cbmV4cG9ydCBjbGFzcyBSYWRhciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xuICBwcml2YXRlIGNlbnRlclggPSAwO1xuICBwcml2YXRlIGNlbnRlclkgPSAwO1xuICBwcml2YXRlIG91dGVyUmFkaXVzID0gMDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQsXG4gICAgcHJpdmF0ZSByZWFkb25seSBtYXhpbXVtRGlzdGFuY2UgPSAyMDAsXG4gICAgcHJpdmF0ZSByZWFkb25seSBudW1iZXJPZlJpbmdzID0gOCkge1xuICAgIHRoaXMuY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpITtcbiAgfVxuXG4gIHJlZnJlc2goKSB7XG4gICAgdGhpcy51cGRhdGUoKTtcbiAgICB0aGlzLnJlbmRlckJhY2tncm91bmQoKTtcbiAgICB0aGlzLnJlbmRlckxpbmVzKCk7XG4gICAgdGhpcy5yZW5kZXJSaW5ncygpO1xuICB9XG5cbiAgcmVuZGVyQWxsKGxvY2FsUGxheWVyOiBhcHAuUGxheWVyLCBwbGF5ZXJzOiBBcnJheTxhcHAuUGxheWVyPiwgbW9kZT86IHN0cmluZykge1xuICAgIGZvciAoY29uc3QgeCBvZiBwbGF5ZXJzKSB7XG4gICAgICBpZiAoeC5pc0xvY2FsKSBjb250aW51ZTtcbiAgICAgIHRoaXMucmVuZGVyT25lKGxvY2FsUGxheWVyLCB4LmxvY2FsT3JpZ2luLnZhbHVlLCB4LmNyZWF0ZUNvbG9yKGxvY2FsUGxheWVyLCBtb2RlKSk7XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyT25lKGxvY2FsUGxheWVyOiBhcHAuUGxheWVyLCBsb2NhbE9yaWdpbjogYXBwLlZlY3Rvciwgc3R5bGU6IHN0cmluZyB8IENhbnZhc0dyYWRpZW50IHwgQ2FudmFzUGF0dGVybikge1xuICAgIGNvbnN0IGR4ID0gKGxvY2FsUGxheWVyLmxvY2FsT3JpZ2luLnZhbHVlLnggLSBsb2NhbE9yaWdpbi54KSAqIDAuMDI1NDtcbiAgICBjb25zdCBkeSA9IChsb2NhbFBsYXllci5sb2NhbE9yaWdpbi52YWx1ZS55IC0gbG9jYWxPcmlnaW4ueSkgKiAwLjAyNTQ7XG4gICAgY29uc3QgciA9IE1hdGguc3FydChNYXRoLnBvdyhkeCwgMikgKyBNYXRoLnBvdyhkeSwgMikpO1xuICAgIGlmIChyIDwgdGhpcy5tYXhpbXVtRGlzdGFuY2UpIHtcbiAgICAgIGNvbnN0IHMgPSB0aGlzLm91dGVyUmFkaXVzIC8gdGhpcy5tYXhpbXVtRGlzdGFuY2U7XG4gICAgICBjb25zdCBhID0gTWF0aC5zaWduKGR5KSAqIE1hdGguYWNvcyhkeCAvIHIpIC0gbG9jYWxQbGF5ZXIudmlld0FuZ2xlcy52YWx1ZS55ICogTWF0aC5QSSAvIDE4MDtcbiAgICAgIGNvbnN0IHggPSB0aGlzLmNlbnRlclggKyBNYXRoLnNpbihhKSAqIHIgKiBzO1xuICAgICAgY29uc3QgeSA9IHRoaXMuY2VudGVyWSArIE1hdGguY29zKGEpICogciAqIHM7XG4gICAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICB0aGlzLmNvbnRleHQuYXJjKHgsIHksIHRoaXMub3V0ZXJSYWRpdXMgLyA0MCwgMCwgTWF0aC5QSSAqIDIpO1xuICAgICAgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IHN0eWxlO1xuICAgICAgdGhpcy5jb250ZXh0LmZpbGwoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbmRlckJhY2tncm91bmQoKSB7XG4gICAgdGhpcy5jb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XG4gICAgdGhpcy5jb250ZXh0LmFyYyh0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSwgdGhpcy5vdXRlclJhZGl1cywgMCwgTWF0aC5QSSAqIDIpO1xuICAgIHRoaXMuY29udGV4dC5maWxsU3R5bGUgPSAnIzAwMCc7XG4gICAgdGhpcy5jb250ZXh0LmZpbGwoKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyTGluZXMoKSB7XG4gICAgdGhpcy5jb250ZXh0LnN0cm9rZVN0eWxlID0gJyNGRkYnO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7XG4gICAgICBjb25zdCB4ID0gdGhpcy5jZW50ZXJYICsgdGhpcy5vdXRlclJhZGl1cyAqIE1hdGguY29zKGkgKiBNYXRoLlBJICogMC4yNSk7XG4gICAgICBjb25zdCB5ID0gdGhpcy5jZW50ZXJZICsgdGhpcy5vdXRlclJhZGl1cyAqIE1hdGguc2luKGkgKiBNYXRoLlBJICogMC4yNSk7XG4gICAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICB0aGlzLmNvbnRleHQubW92ZVRvKHRoaXMuY2VudGVyWCwgdGhpcy5jZW50ZXJZKTtcbiAgICAgIHRoaXMuY29udGV4dC5saW5lVG8oeCwgeSk7XG4gICAgICB0aGlzLmNvbnRleHQuc3Ryb2tlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJSaW5ncygpIHtcbiAgICB0aGlzLmNvbnRleHQuc3Ryb2tlU3R5bGUgPSAnI0ZGRic7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdGhpcy5udW1iZXJPZlJpbmdzOyBpKyspIHtcbiAgICAgIHRoaXMuY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICAgIHRoaXMuY29udGV4dC5hcmModGhpcy5jZW50ZXJYLCB0aGlzLmNlbnRlclksIHRoaXMub3V0ZXJSYWRpdXMgKiBpIC8gdGhpcy5udW1iZXJPZlJpbmdzLCAwLCBNYXRoLlBJICogMik7XG4gICAgICB0aGlzLmNvbnRleHQuc3Ryb2tlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGUoKSB7XG4gICAgdGhpcy5jZW50ZXJYID0gdGhpcy5jYW52YXMud2lkdGggLyAyO1xuICAgIHRoaXMuY2VudGVyWSA9IHRoaXMuY2FudmFzLmhlaWdodCAvIDI7XG4gICAgdGhpcy5vdXRlclJhZGl1cyA9ICh0aGlzLmNhbnZhcy53aWR0aCA+IHRoaXMuY2FudmFzLmhlaWdodCA/IHRoaXMuY2FudmFzLmhlaWdodCA6IHRoaXMuY2FudmFzLndpZHRoKSAvIDI7XG4gIH1cbn1cbiJdfQ==