"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Map = void 0;
class Map {
    constructor(canvas) {
        this.canvas = canvas;
        this.image = new Image();
        this.ratioX = 0;
        this.ratioY = 0;
        this.scaleR = 0;
        this.scaleX = 0;
        this.scaleY = 0;
        this.shiftX = 0;
        this.shiftY = 0;
        this.context = canvas.getContext('2d');
    }
    refresh(levelName) {
        this.fetch(levelName);
        this.update();
        this.renderBackground();
    }
    renderAll(localPlayer, players, mode) {
        for (const x of players) {
            this.renderOne(x.localOrigin.value, x.createColor(localPlayer, mode));
        }
    }
    renderOne(localOrigin, style) {
        if (!this.map)
            return;
        const x = this.shiftX + (1 / this.image.width * this.scaleX) * (localOrigin.x - this.map.x) / this.ratioX;
        const y = this.shiftY + (1 / this.image.height * this.scaleY) * (localOrigin.y - this.map.y) / -this.ratioY;
        this.context.beginPath();
        this.context.arc(x, y, this.scaleR * 8, 0, Math.PI * 2);
        this.context.fillStyle = style;
        this.context.fill();
    }
    fetch(levelName) {
        this.map = getDataByLevelName(levelName);
        this.image.src = this.map ? `images/maps/${levelName}.webp` : 'images/maps.webp';
    }
    renderBackground() {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.context.drawImage(this.image, 0, 0, this.image.width, this.image.height, this.shiftX, this.shiftY, this.scaleX, this.scaleY);
    }
    update() {
        if (!this.map)
            return;
        this.ratioX = (this.map.y - this.map.x) / this.image.width;
        this.ratioY = (this.map.y - this.map.x) / this.image.height;
        this.scaleR = Math.min(this.canvas.width / this.image.width, this.canvas.height / this.image.height);
        this.scaleX = this.image.width * this.scaleR;
        this.scaleY = this.image.height * this.scaleR;
        this.shiftX = (this.canvas.width - this.scaleX) / 2;
        this.shiftY = (this.canvas.height - this.scaleY) / 2;
    }
}
exports.Map = Map;
function getDataByLevelName(levelName) {
    switch (levelName) {
        case 'mp_rr_canyonlands_mu3':
            return { x: -37541, y: 43886 };
        case 'mp_rr_desertlands_mu3':
            return { x: -45056, y: 45055 };
        case 'mp_rr_olympus_mu2':
            return { x: -52024, y: 48025 };
        case 'mp_rr_tropic_island_mu1':
            return { x: -50606, y: 52139 };
        default:
            return;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9mZWF0dXJlcy9NYXAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBRUEsTUFBYSxHQUFHO0lBWWQsWUFDbUIsTUFBeUI7UUFBekIsV0FBTSxHQUFOLE1BQU0sQ0FBbUI7UUFYM0IsVUFBSyxHQUFHLElBQUksS0FBSyxFQUFFLENBQUM7UUFFN0IsV0FBTSxHQUFHLENBQUMsQ0FBQztRQUNYLFdBQU0sR0FBRyxDQUFDLENBQUM7UUFDWCxXQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ1gsV0FBTSxHQUFHLENBQUMsQ0FBQztRQUNYLFdBQU0sR0FBRyxDQUFDLENBQUM7UUFDWCxXQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ1gsV0FBTSxHQUFHLENBQUMsQ0FBQztRQUlqQixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFFLENBQUM7SUFDMUMsQ0FBQztJQUVELE9BQU8sQ0FBQyxTQUFzQjtRQUM1QixJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNkLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFRCxTQUFTLENBQUMsV0FBdUIsRUFBRSxPQUEwQixFQUFFLElBQWE7UUFDMUUsS0FBSyxNQUFNLENBQUMsSUFBSSxPQUFPLEVBQUU7WUFDdkIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQ3ZFO0lBQ0gsQ0FBQztJQUVELFNBQVMsQ0FBQyxXQUF1QixFQUFFLEtBQThDO1FBQy9FLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRztZQUFFLE9BQU87UUFDdEIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMxRyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDNUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUMvQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFFTyxLQUFLLENBQUMsU0FBc0I7UUFDbEMsSUFBSSxDQUFDLEdBQUcsR0FBRyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxlQUFlLFNBQVMsT0FBTyxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQztJQUNuRixDQUFDO0lBRU8sZ0JBQWdCO1FBQ3RCLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNwRSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ25JLENBQUM7SUFFTyxNQUFNO1FBQ1osSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHO1lBQUUsT0FBTztRQUN0QixJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQztRQUMzRCxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUM1RCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNyRyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDN0MsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQzlDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7Q0FDRjtBQTNERCxrQkEyREM7QUFFRCxTQUFTLGtCQUFrQixDQUFDLFNBQXNCO0lBQ2hELFFBQVEsU0FBUyxFQUFFO1FBQ2pCLEtBQUssdUJBQXVCO1lBQzFCLE9BQU8sRUFBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBQyxDQUFDO1FBQy9CLEtBQUssdUJBQXVCO1lBQzFCLE9BQU8sRUFBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBQyxDQUFDO1FBQy9CLEtBQUssbUJBQW1CO1lBQ3RCLE9BQU8sRUFBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBQyxDQUFDO1FBQy9CLEtBQUsseUJBQXlCO1lBQzVCLE9BQU8sRUFBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBQyxDQUFDO1FBQy9CO1lBQ0UsT0FBTztLQUNWO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFwcCBmcm9tICcuLic7XG5cbmV4cG9ydCBjbGFzcyBNYXAge1xuICBwcml2YXRlIHJlYWRvbmx5IGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcbiAgcHJpdmF0ZSByZWFkb25seSBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuICBwcml2YXRlIG1hcD86IFJldHVyblR5cGU8dHlwZW9mIGdldERhdGFCeUxldmVsTmFtZT47XG4gIHByaXZhdGUgcmF0aW9YID0gMDtcbiAgcHJpdmF0ZSByYXRpb1kgPSAwO1xuICBwcml2YXRlIHNjYWxlUiA9IDA7XG4gIHByaXZhdGUgc2NhbGVYID0gMDtcbiAgcHJpdmF0ZSBzY2FsZVkgPSAwO1xuICBwcml2YXRlIHNoaWZ0WCA9IDA7XG4gIHByaXZhdGUgc2hpZnRZID0gMDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpIHtcbiAgICB0aGlzLmNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSE7XG4gIH1cblxuICByZWZyZXNoKGxldmVsTmFtZTogYXBwLkNTdHJpbmcpIHtcbiAgICB0aGlzLmZldGNoKGxldmVsTmFtZSk7XG4gICAgdGhpcy51cGRhdGUoKTtcbiAgICB0aGlzLnJlbmRlckJhY2tncm91bmQoKTtcbiAgfVxuXG4gIHJlbmRlckFsbChsb2NhbFBsYXllcjogYXBwLlBsYXllciwgcGxheWVyczogQXJyYXk8YXBwLlBsYXllcj4sIG1vZGU/OiBzdHJpbmcpIHtcbiAgICBmb3IgKGNvbnN0IHggb2YgcGxheWVycykge1xuICAgICAgdGhpcy5yZW5kZXJPbmUoeC5sb2NhbE9yaWdpbi52YWx1ZSwgeC5jcmVhdGVDb2xvcihsb2NhbFBsYXllciwgbW9kZSkpO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlck9uZShsb2NhbE9yaWdpbjogYXBwLlZlY3Rvciwgc3R5bGU6IHN0cmluZyB8IENhbnZhc0dyYWRpZW50IHwgQ2FudmFzUGF0dGVybikge1xuICAgIGlmICghdGhpcy5tYXApIHJldHVybjtcbiAgICBjb25zdCB4ID0gdGhpcy5zaGlmdFggKyAoMSAvIHRoaXMuaW1hZ2Uud2lkdGggKiB0aGlzLnNjYWxlWCkgKiAobG9jYWxPcmlnaW4ueCAtIHRoaXMubWFwLngpIC8gdGhpcy5yYXRpb1g7XG4gICAgY29uc3QgeSA9IHRoaXMuc2hpZnRZICsgKDEgLyB0aGlzLmltYWdlLmhlaWdodCAqIHRoaXMuc2NhbGVZKSAqIChsb2NhbE9yaWdpbi55IC0gdGhpcy5tYXAueSkgLyAtdGhpcy5yYXRpb1k7XG4gICAgdGhpcy5jb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgIHRoaXMuY29udGV4dC5hcmMoeCwgeSwgdGhpcy5zY2FsZVIgKiA4LCAwLCBNYXRoLlBJICogMik7XG4gICAgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IHN0eWxlO1xuICAgIHRoaXMuY29udGV4dC5maWxsKCk7XG4gIH1cblxuICBwcml2YXRlIGZldGNoKGxldmVsTmFtZTogYXBwLkNTdHJpbmcpIHtcbiAgICB0aGlzLm1hcCA9IGdldERhdGFCeUxldmVsTmFtZShsZXZlbE5hbWUpO1xuICAgIHRoaXMuaW1hZ2Uuc3JjID0gdGhpcy5tYXAgPyBgaW1hZ2VzL21hcHMvJHtsZXZlbE5hbWV9LndlYnBgIDogJ2ltYWdlcy9tYXBzLndlYnAnO1xuICB9XG5cbiAgcHJpdmF0ZSByZW5kZXJCYWNrZ3JvdW5kKCkge1xuICAgIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XG4gICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLmltYWdlLCAwLDAsIHRoaXMuaW1hZ2Uud2lkdGgsIHRoaXMuaW1hZ2UuaGVpZ2h0LCB0aGlzLnNoaWZ0WCwgdGhpcy5zaGlmdFksIHRoaXMuc2NhbGVYLCB0aGlzLnNjYWxlWSk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZSgpIHtcbiAgICBpZiAoIXRoaXMubWFwKSByZXR1cm47XG4gICAgdGhpcy5yYXRpb1ggPSAodGhpcy5tYXAueSAtIHRoaXMubWFwLngpIC8gdGhpcy5pbWFnZS53aWR0aDtcbiAgICB0aGlzLnJhdGlvWSA9ICh0aGlzLm1hcC55IC0gdGhpcy5tYXAueCkgLyB0aGlzLmltYWdlLmhlaWdodDtcbiAgICB0aGlzLnNjYWxlUiA9IE1hdGgubWluKHRoaXMuY2FudmFzLndpZHRoIC8gdGhpcy5pbWFnZS53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0IC8gdGhpcy5pbWFnZS5oZWlnaHQpO1xuICAgIHRoaXMuc2NhbGVYID0gdGhpcy5pbWFnZS53aWR0aCAqIHRoaXMuc2NhbGVSO1xuICAgIHRoaXMuc2NhbGVZID0gdGhpcy5pbWFnZS5oZWlnaHQgKiB0aGlzLnNjYWxlUjtcbiAgICB0aGlzLnNoaWZ0WCA9ICh0aGlzLmNhbnZhcy53aWR0aCAtIHRoaXMuc2NhbGVYKSAvIDI7XG4gICAgdGhpcy5zaGlmdFkgPSAodGhpcy5jYW52YXMuaGVpZ2h0IC0gdGhpcy5zY2FsZVkpIC8gMjsgIFxuICB9XG59XG5cbmZ1bmN0aW9uIGdldERhdGFCeUxldmVsTmFtZShsZXZlbE5hbWU6IGFwcC5DU3RyaW5nKSB7XG4gIHN3aXRjaCAobGV2ZWxOYW1lKSB7XG4gICAgY2FzZSAnbXBfcnJfY2FueW9ubGFuZHNfbXUzJzpcbiAgICAgIHJldHVybiB7eDogLTM3NTQxLCB5OiA0Mzg4Nn07XG4gICAgY2FzZSAnbXBfcnJfZGVzZXJ0bGFuZHNfbXUzJzpcbiAgICAgIHJldHVybiB7eDogLTQ1MDU2LCB5OiA0NTA1NX07XG4gICAgY2FzZSAnbXBfcnJfb2x5bXB1c19tdTInOlxuICAgICAgcmV0dXJuIHt4OiAtNTIwMjQsIHk6IDQ4MDI1fTtcbiAgICBjYXNlICdtcF9ycl90cm9waWNfaXNsYW5kX211MSc6XG4gICAgICByZXR1cm4ge3g6IC01MDYwNiwgeTogNTIxMzl9O1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm47XG4gIH1cbn1cbiJdfQ==